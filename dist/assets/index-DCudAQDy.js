var Z=(b,N)=>()=>(N||b((N={exports:{}}).exports,N),N.exports);var K=Z((_,k)=>{(function(){const N=document.createElement("link").relList;if(N&&N.supports&&N.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))V(n);new MutationObserver(n=>{for(const g of n)if(g.type==="childList")for(const D of g.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&V(D)}).observe(document,{childList:!0,subtree:!0});function E(n){const g={};return n.integrity&&(g.integrity=n.integrity),n.referrerPolicy&&(g.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?g.credentials="include":n.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function V(n){if(n.ep)return;n.ep=!0;const g=E(n);fetch(n.href,g)}})();(function(b,N){typeof _=="object"&&typeof k<"u"?k.exports=N(require("three"),require("three/examples/jsm/loaders/STLLoader.js"),require("three/examples/jsm/loaders/ColladaLoader.js")):typeof define=="function"&&define.amd?define(["three","three/examples/jsm/loaders/STLLoader.js","three/examples/jsm/loaders/ColladaLoader.js"],N):(b=typeof globalThis<"u"?globalThis:b||self,b.URDFLoader=N(b.THREE,b.THREE,b.THREE))})(void 0,function(b,N,E){function V(m){if(m&&m.__esModule)return m;var e=Object.create(null);return m&&Object.keys(m).forEach(function(i){if(i!=="default"){var t=Object.getOwnPropertyDescriptor(m,i);Object.defineProperty(e,i,t.get?t:{enumerable:!0,get:function(){return m[i]}})}}),e.default=m,Object.freeze(e)}var n=V(b);class g extends b.Object3D{constructor(...e){super(...e),this.urdfNode=null,this.urdfName=""}copy(e,i){return super.copy(e,i),this.urdfNode=e.urdfNode,this.urdfName=e.urdfName,this}}class D extends g{constructor(...e){super(...e),this.isURDFCollider=!0,this.type="URDFCollider"}}class B extends g{constructor(...e){super(...e),this.isURDFVisual=!0,this.type="URDFVisual"}}class C extends g{constructor(...e){super(...e),this.isURDFLink=!0,this.type="URDFLink"}}class J extends g{get jointType(){return this._jointType}set jointType(e){if(this.jointType!==e)switch(this._jointType=e,this.matrixWorldNeedsUpdate=!0,e){case"fixed":this.jointValue=[];break;case"continuous":case"revolute":case"prismatic":this.jointValue=new Array(1).fill(0);break;case"planar":this.jointValue=new Array(2).fill(0);break;case"floating":this.jointValue=new Array(6).fill(0);break}}get angle(){return this.jointValue[0]}constructor(...e){super(...e),this.isURDFJoint=!0,this.type="URDFJoint",this.jointValue=null,this.jointType="fixed",this.axis=new b.Vector3(1,0,0),this.limit={lower:0,upper:0},this.ignoreLimits=!1,this.origPosition=null,this.origQuaternion=null,this.mimicJoints=[]}copy(e,i){return super.copy(e,i),this.jointType=e.jointType,this.axis=e.axis.clone(),this.limit.lower=e.limit.lower,this.limit.upper=e.limit.upper,this.ignoreLimits=!1,this.jointValue=[...e.jointValue],this.origPosition=e.origPosition?e.origPosition.clone():null,this.origQuaternion=e.origQuaternion?e.origQuaternion.clone():null,this.mimicJoints=[...e.mimicJoints],this}setJointValue(...e){e=e.map(t=>parseFloat(t)),(!this.origPosition||!this.origQuaternion)&&(this.origPosition=this.position.clone(),this.origQuaternion=this.quaternion.clone());let i=!1;switch(this.mimicJoints.forEach(t=>{i=t.updateFromMimickedJoint(...e)||i}),this.jointType){case"fixed":return i;case"continuous":case"revolute":{let t=e[0];return t==null||t===this.jointValue[0]?i:(!this.ignoreLimits&&this.jointType==="revolute"&&(t=Math.min(this.limit.upper,t),t=Math.max(this.limit.lower,t)),this.quaternion.setFromAxisAngle(this.axis,t).premultiply(this.origQuaternion),this.jointValue[0]!==t?(this.jointValue[0]=t,this.matrixWorldNeedsUpdate=!0,!0):i)}case"prismatic":{let t=e[0];return t==null||t===this.jointValue[0]?i:(this.ignoreLimits||(t=Math.min(this.limit.upper,t),t=Math.max(this.limit.lower,t)),this.position.copy(this.origPosition),this.position.addScaledVector(this.axis,t),this.jointValue[0]!==t?(this.jointValue[0]=t,this.matrixWorldNeedsUpdate=!0,!0):i)}case"floating":case"planar":console.warn(`'${this.jointType}' joint not yet supported`)}return i}}class T extends J{constructor(...e){super(...e),this.type="URDFMimicJoint",this.mimicJoint=null,this.offset=0,this.multiplier=1}updateFromMimickedJoint(...e){const i=e.map(t=>t*this.multiplier+this.offset);return super.setJointValue(...i)}copy(e,i){return super.copy(e,i),this.mimicJoint=e.mimicJoint,this.offset=e.offset,this.multiplier=e.multiplier,this}}class G extends C{constructor(...e){super(...e),this.isURDFRobot=!0,this.urdfNode=null,this.urdfRobotNode=null,this.robotName=null,this.links=null,this.joints=null,this.colliders=null,this.visual=null,this.frames=null}copy(e,i){return super.copy(e,i),this.urdfRobotNode=e.urdfRobotNode,this.robotName=e.robotName,this.links={},this.joints={},this.colliders={},this.visual={},this.traverse(t=>{t.isURDFJoint&&t.urdfName in e.joints&&(this.joints[t.urdfName]=t),t.isURDFLink&&t.urdfName in e.links&&(this.links[t.urdfName]=t),t.isURDFCollider&&t.urdfName in e.colliders&&(this.colliders[t.urdfName]=t),t.isURDFVisual&&t.urdfName in e.visual&&(this.visual[t.urdfName]=t)}),this.frames={...this.colliders,...this.visual,...this.links,...this.joints},this}getFrame(e){return this.frames[e]}setJointValue(e,...i){const t=this.joints[e];return t?t.setJointValue(...i):!1}setJointValues(e){let i=!1;for(const t in e){const L=e[t];Array.isArray(L)?i=this.setJointValue(t,...L)||i:i=this.setJointValue(t,L)||i}return i}}const P=new n.Quaternion,v=new n.Euler;function M(m){return m?m.trim().split(/\s+/g).map(e=>parseFloat(e)):[0,0,0]}function O(m,e,i=!1){i||m.rotation.set(0,0,0),v.set(e[0],e[1],e[2],"ZYX"),P.setFromEuler(v),P.multiply(m.quaternion),m.quaternion.copy(P)}class W{constructor(e){this.manager=e||n.DefaultLoadingManager,this.loadMeshCb=this.defaultMeshLoader.bind(this),this.parseVisual=!0,this.parseCollision=!1,this.packages="",this.workingPath="",this.fetchOptions={}}loadAsync(e){return new Promise((i,t)=>{this.load(e,i,null,t)})}load(e,i,t,L){const R=this.manager,U=n.LoaderUtils.extractUrlBase(e),x=this.manager.resolveURL(e);R.itemStart(x),fetch(x,this.fetchOptions).then(w=>{if(w.ok)return t&&t(null),w.text();throw new Error(`URDFLoader: Failed to load url '${x}' with error code ${w.status} : ${w.statusText}.`)}).then(w=>{this.workingPath===""&&(this.workingPath=U);const j=this.parse(w);i(j),R.itemEnd(x)}).catch(w=>{L?L(w):console.error("URDFLoader: Error loading file.",w),R.itemError(x),R.itemEnd(x)})}parse(e){const i=this.packages,t=this.loadMeshCb,L=this.parseVisual,R=this.parseCollision,U=this.workingPath,x=this.manager,w={},j={},q={};function S(u){if(!/^package:\/\//.test(u))return U?U+u:u;const[d,f]=u.replace(/^package:\/\//,"").split(/\/(.+)/);if(typeof i=="string")return i.endsWith(d)?i+"/"+f:i+"/"+d+"/"+f;if(i instanceof Function)return i(d)+"/"+f;if(typeof i=="object")return d in i?i[d]+"/"+f:(console.error(`URDFLoader : ${d} not found in provided package list.`),null)}function H(u){let d;u instanceof Document?d=[...u.children]:u instanceof Element?d=[u]:d=[...new DOMParser().parseFromString(u,"text/xml").children];const f=d.filter(o=>o.nodeName==="robot").pop();return I(f)}function I(u){const d=[...u.children],f=d.filter(l=>l.nodeName.toLowerCase()==="link"),o=d.filter(l=>l.nodeName.toLowerCase()==="joint"),p=d.filter(l=>l.nodeName.toLowerCase()==="material"),c=new G;c.robotName=u.getAttribute("name"),c.urdfRobotNode=u,p.forEach(l=>{const s=l.getAttribute("name");q[s]=z(l)});const a={},r={};f.forEach(l=>{const s=l.getAttribute("name"),h=u.querySelector(`child[link="${s}"]`)===null;w[s]=Y(l,a,r,h?c:null)}),o.forEach(l=>{const s=l.getAttribute("name");j[s]=X(l)}),c.joints=j,c.links=w,c.colliders=r,c.visual=a;const y=Object.values(j);return y.forEach(l=>{l instanceof T&&j[l.mimicJoint].mimicJoints.push(l)}),y.forEach(l=>{const s=new Set,h=A=>{if(s.has(A))throw new Error("URDFLoader: Detected an infinite loop of mimic joints.");s.add(A),A.mimicJoints.forEach(F=>{h(F)})};h(l)}),c.frames={...r,...a,...w,...j},c}function X(u){const d=[...u.children],f=u.getAttribute("type");let o;const p=d.find(s=>s.nodeName.toLowerCase()==="mimic");p?(o=new T,o.mimicJoint=p.getAttribute("joint"),o.multiplier=parseFloat(p.getAttribute("multiplier")||1),o.offset=parseFloat(p.getAttribute("offset")||0)):o=new J,o.urdfNode=u,o.name=u.getAttribute("name"),o.urdfName=o.name,o.jointType=f;let c=null,a=null,r=[0,0,0],y=[0,0,0];d.forEach(s=>{const h=s.nodeName.toLowerCase();h==="origin"?(r=M(s.getAttribute("xyz")),y=M(s.getAttribute("rpy"))):h==="child"?a=w[s.getAttribute("link")]:h==="parent"?c=w[s.getAttribute("link")]:h==="limit"&&(o.limit.lower=parseFloat(s.getAttribute("lower")||o.limit.lower),o.limit.upper=parseFloat(s.getAttribute("upper")||o.limit.upper))}),c.add(o),o.add(a),O(o,y),o.position.set(r[0],r[1],r[2]);const l=d.filter(s=>s.nodeName.toLowerCase()==="axis")[0];if(l){const s=l.getAttribute("xyz").split(/\s+/g).map(h=>parseFloat(h));o.axis=new n.Vector3(s[0],s[1],s[2]),o.axis.normalize()}return o}function Y(u,d,f,o=null){o===null&&(o=new C);const p=[...u.children];return o.name=u.getAttribute("name"),o.urdfName=o.name,o.urdfNode=u,L&&p.filter(a=>a.nodeName.toLowerCase()==="visual").forEach(a=>{const r=Q(a,q);if(o.add(r),a.hasAttribute("name")){const y=a.getAttribute("name");r.name=y,r.urdfName=y,d[y]=r}}),R&&p.filter(a=>a.nodeName.toLowerCase()==="collision").forEach(a=>{const r=Q(a);if(o.add(r),a.hasAttribute("name")){const y=a.getAttribute("name");r.name=y,r.urdfName=y,f[y]=r}}),o}function z(u){const d=[...u.children],f=new n.MeshPhongMaterial;return f.name=u.getAttribute("name")||"",d.forEach(o=>{const p=o.nodeName.toLowerCase();if(p==="color"){const c=o.getAttribute("rgba").split(/\s/g).map(a=>parseFloat(a));f.color.setRGB(c[0],c[1],c[2]).convertSRGBToLinear(),f.opacity=c[3],f.transparent=c[3]<1,f.depthWrite=!f.transparent}else if(p==="texture"){const c=o.getAttribute("filename");if(c){const a=new n.TextureLoader(x),r=S(c);f.map=a.load(r),f.map.encoding=n.sRGBEncoding}}}),f}function Q(u,d={}){const f=u.nodeName.toLowerCase()==="collision",o=[...u.children];let p=null;const c=o.filter(r=>r.nodeName.toLowerCase()==="material")[0];if(c){const r=c.getAttribute("name");r&&r in d?p=d[r]:p=z(c)}else p=new n.MeshPhongMaterial;const a=f?new D:new B;return a.urdfNode=u,o.forEach(r=>{const y=r.nodeName.toLowerCase();if(y==="geometry"){const l=r.children[0].nodeName.toLowerCase();if(l==="mesh"){const s=r.children[0].getAttribute("filename"),h=S(s);if(h!==null){const A=r.children[0].getAttribute("scale");if(A){const F=M(A);a.scale.set(F[0],F[1],F[2])}t(h,x,(F,$)=>{$?console.error("URDFLoader: Error loading mesh.",$):F&&(F instanceof n.Mesh&&(F.material=p),F.position.set(0,0,0),F.quaternion.identity(),a.add(F))})}}else if(l==="box"){const s=new n.Mesh;s.geometry=new n.BoxGeometry(1,1,1),s.material=p;const h=M(r.children[0].getAttribute("size"));s.scale.set(h[0],h[1],h[2]),a.add(s)}else if(l==="sphere"){const s=new n.Mesh;s.geometry=new n.SphereGeometry(1,30,30),s.material=p;const h=parseFloat(r.children[0].getAttribute("radius"))||0;s.scale.set(h,h,h),a.add(s)}else if(l==="cylinder"){const s=new n.Mesh;s.geometry=new n.CylinderGeometry(1,1,1,30),s.material=p;const h=parseFloat(r.children[0].getAttribute("radius"))||0,A=parseFloat(r.children[0].getAttribute("length"))||0;s.scale.set(h,A,h),s.rotation.set(Math.PI/2,0,0),a.add(s)}}else if(y==="origin"){const l=M(r.getAttribute("xyz")),s=M(r.getAttribute("rpy"));a.position.set(l[0],l[1],l[2]),a.rotation.set(0,0,0),O(a,s)}}),a}return H(e)}defaultMeshLoader(e,i,t){/\.stl$/i.test(e)?new N.STLLoader(i).load(e,R=>{const U=new n.Mesh(R,new n.MeshPhongMaterial);t(U)}):/\.dae$/i.test(e)?new E.ColladaLoader(i).load(e,R=>t(R.scene)):console.warn(`URDFLoader: Could not load model at ${e}.
No loader available`)}}return W})});export default K();
